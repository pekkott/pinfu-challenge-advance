---

- name: create conf directory
  file:
    path: /etc/nginx/templates
    state: directory

- name: Check cert
  stat: path="{{ letsencrypt_cert_directory }}"
  register: cert_stat

- name: Set nginx_cert_exist
  set_fact:
    nginx_cert_exist: "{{ cert_stat.stat.exists }}"

- name: Set nginx_port
  set_fact:
    nginx_port: 443
  when: "{{ nginx_cert_exist }}"

- name: copy a conf file
  template:
    src=conf/{{ item }}.conf.template.j2
    dest=/etc/nginx/templates/{{ item }}.conf.template
  with_items:
    - default
    - mahjong-play-manager

- name: copy docker-compose.yml
  template:
    src=docker-compose.yml.j2
    dest="{{ working_directory }}/docker-compose-nginx.yml"
